var CONFIG={status:"start",level:1,totalLevel:6,numPerLine:6,canvasPadding:30,bulletSize:10,bulletSpeed:10,enemySpeed:2,enemySize:50,enemyGap:10,enemyIcon:"./img/enemy.png",enemyBoomIcon:"./img/boom.png",enemyDirection:"right",planeSpeed:5,planeSize:{width:60,height:100},planeIcon:"./img/plane.png",score:0};var container=document.getElementById("game");var canvas=document.getElementById("canvas");var context=canvas.getContext("2d");var cleartime=0;var blts=[];var msts=[];msts.shoulddown=false;var GAME={init:function(opts){this.status="start";this.bindEvent();$("canvas").hide()},bindEvent:function(){var self=this;var playBtn=document.querySelector(".js-play");var replayBtn=document.querySelector(".js-replay");var replayBtn2=document.querySelector(".js-replay2");var nextBtn=document.querySelector(".js-next");playBtn.onclick=function(){self.play()};replayBtn.onclick=function(){CONFIG.score=0;CONFIG.level=1;self.play()};replayBtn2.onclick=function(){CONFIG.score=0;CONFIG.level=1;self.play()};nextBtn.onclick=function(){self.play()};document.onkeydown=function(event){var e=window.event||arguments[0];if(e.keyCode==39){plane.state=1}if(e.keyCode==37){plane.state=-1}if(e.keyCode==32){plane.shoot()}};document.onkeyup=function(){var e=window.event||arguments[0];if(e.keyCode==32){return false}if(e.keyCode==39||e.keyCode==37){plane.state=0}}},setStatus:function(status){this.status=status;container.setAttribute("data-status",status)},play:function(){window.cancelAnimationFrame(cleartime);$("canvas").show();this.setStatus("playing");plane.print();initmsts();animate()},failed:function(){this.setStatus("failed");msts=[];context.clearRect(0,0,canvas.width,canvas.height);$("canvas").hide();window.cancelAnimationFrame(cleartime)},success:function(){this.setStatus("success");context.clearRect(0,0,canvas.width,canvas.height);CONFIG.level+=1;$("canvas").hide();window.cancelAnimationFrame(cleartime)},allsuccess:function(){this.setStatus("all-success");context.clearRect(0,0,canvas.width,canvas.height);$("canvas").hide();window.cancelAnimationFrame(cleartime)}};GAME.init();plane.planeinit();window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){window.setTimeout(callback,1e3/60)};function animate(){context.clearRect(0,0,canvas.width,canvas.height);for(var i=blts.length-1;i>=0;i--){blts[i].show();blts[i].fly();blts[i].touch()}for(var i=0;i<msts.length;i++){msts[i].show();msts[i].move()}plane.move();plane.print();cleartime=requestAnimationFrame(animate);context.fillStyle="white";context.font="20px arial";context.fillText("分数:"+CONFIG.score,30,50)}function initmsts(){var num=7*CONFIG.level;for(var i=0;i<num;i++){var monster=null;monster=new Monster(i%7*(50+CONFIG.enemyGap-i/8)+i/8,Math.floor(i/7)*50,i);msts.push(monster)}}